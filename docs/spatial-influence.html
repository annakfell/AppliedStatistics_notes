<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Applied Statistics</title>
  <meta name="description" content="Course notes for Applied Statistics courses at CSU Chico">
  <meta name="generator" content="bookdown 0.7 and GitBook 2.6.7">

  <meta property="og:title" content="Applied Statistics" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Course notes for Applied Statistics courses at CSU Chico" />
  <meta name="github-repo" content="norcalbiostat/AppliedStatistics_notes" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Applied Statistics" />
  
  <meta name="twitter:description" content="Course notes for Applied Statistics courses at CSU Chico" />
  

<meta name="author" content="Robin A. Donatello and Edward A. Roualdes">



  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="mapping-in-r.html">
<link rel="next" href="modeling-geographically-correlated-data.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Applied Statistics course notes</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a></li>
<li class="chapter" data-level="1" data-path="data-prep.html"><a href="data-prep.html"><i class="fa fa-check"></i><b>1</b> Preparing Data for Analysis</a><ul>
<li class="chapter" data-level="1.1" data-path="reproducible-workflows.html"><a href="reproducible-workflows.html"><i class="fa fa-check"></i><b>1.1</b> Reproducible Workflows</a></li>
<li class="chapter" data-level="1.2" data-path="identifying-variable-types.html"><a href="identifying-variable-types.html"><i class="fa fa-check"></i><b>1.2</b> Identifying Variable Types</a></li>
<li class="chapter" data-level="1.3" data-path="data-editing-and-recoding.html"><a href="data-editing-and-recoding.html"><i class="fa fa-check"></i><b>1.3</b> Data Editing and Recoding</a></li>
<li class="chapter" data-level="1.4" data-path="outliers.html"><a href="outliers.html"><i class="fa fa-check"></i><b>1.4</b> Outliers</a></li>
<li class="chapter" data-level="1.5" data-path="data-transformations.html"><a href="data-transformations.html"><i class="fa fa-check"></i><b>1.5</b> Data Transformations</a></li>
<li class="chapter" data-level="1.6" data-path="selecting-appropriate-analysis.html"><a href="selecting-appropriate-analysis.html"><i class="fa fa-check"></i><b>1.6</b> Selecting Appropriate Analysis</a></li>
<li class="chapter" data-level="1.7" data-path="wide-vs-long-data.html"><a href="wide-vs-long-data.html"><i class="fa fa-check"></i><b>1.7</b> Wide vs.Â Long data</a></li>
<li class="chapter" data-level="1.8" data-path="dealing-with-missing-data-post-analysis.html"><a href="dealing-with-missing-data-post-analysis.html"><i class="fa fa-check"></i><b>1.8</b> Dealing with missing data post-analysis</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="data-viz.html"><a href="data-viz.html"><i class="fa fa-check"></i><b>2</b> Visualizing Data</a></li>
<li class="part"><span><b>I Regression Modeling</b></span></li>
<li class="chapter" data-level="3" data-path="reg-intro.html"><a href="reg-intro.html"><i class="fa fa-check"></i><b>3</b> Introduction</a></li>
<li class="chapter" data-level="4" data-path="simple-linear-regression.html"><a href="simple-linear-regression.html"><i class="fa fa-check"></i><b>4</b> Simple Linear Regression</a><ul>
<li class="chapter" data-level="4.1" data-path="mathmatical-model.html"><a href="mathmatical-model.html"><i class="fa fa-check"></i><b>4.1</b> Mathmatical Model</a></li>
<li class="chapter" data-level="4.2" data-path="parameter-estimates.html"><a href="parameter-estimates.html"><i class="fa fa-check"></i><b>4.2</b> Parameter Estimates</a></li>
<li class="chapter" data-level="4.3" data-path="interval-estimation.html"><a href="interval-estimation.html"><i class="fa fa-check"></i><b>4.3</b> Interval estimation</a></li>
<li class="chapter" data-level="4.4" data-path="corelation-coefficient.html"><a href="corelation-coefficient.html"><i class="fa fa-check"></i><b>4.4</b> Corelation Coefficient</a></li>
<li class="chapter" data-level="4.5" data-path="assumptions.html"><a href="assumptions.html"><i class="fa fa-check"></i><b>4.5</b> Assumptions</a></li>
<li class="chapter" data-level="4.6" data-path="example.html"><a href="example.html"><i class="fa fa-check"></i><b>4.6</b> Example</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="multiple-linear-regression.html"><a href="multiple-linear-regression.html"><i class="fa fa-check"></i><b>5</b> Multiple Linear Regression</a><ul>
<li class="chapter" data-level="5.1" data-path="types-of-x-variables.html"><a href="types-of-x-variables.html"><i class="fa fa-check"></i><b>5.1</b> Types of X variables</a></li>
<li class="chapter" data-level="5.2" data-path="mathematical-model.html"><a href="mathematical-model.html"><i class="fa fa-check"></i><b>5.2</b> Mathematical Model</a></li>
<li class="chapter" data-level="5.3" data-path="parameter-estimation.html"><a href="parameter-estimation.html"><i class="fa fa-check"></i><b>5.3</b> Parameter Estimation</a></li>
<li class="chapter" data-level="5.4" data-path="example-1.html"><a href="example-1.html"><i class="fa fa-check"></i><b>5.4</b> Example</a></li>
<li class="chapter" data-level="5.5" data-path="model-diagnostics.html"><a href="model-diagnostics.html"><i class="fa fa-check"></i><b>5.5</b> Model Diagnostics</a></li>
<li class="chapter" data-level="5.6" data-path="multicollinearity.html"><a href="multicollinearity.html"><i class="fa fa-check"></i><b>5.6</b> Multicollinearity</a></li>
<li class="chapter" data-level="5.7" data-path="what-to-watch-out-for.html"><a href="what-to-watch-out-for.html"><i class="fa fa-check"></i><b>5.7</b> What to watch out for</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="model-building.html"><a href="model-building.html"><i class="fa fa-check"></i><b>6</b> Model Building</a><ul>
<li class="chapter" data-level="6.1" data-path="categorical-predictors.html"><a href="categorical-predictors.html"><i class="fa fa-check"></i><b>6.1</b> Categorical Predictors</a><ul>
<li class="chapter" data-level="6.1.1" data-path="categorical-predictors.html"><a href="categorical-predictors.html#factor-variable-coding"><i class="fa fa-check"></i><b>6.1.1</b> Factor variable coding</a></li>
<li class="chapter" data-level="6.1.2" data-path="categorical-predictors.html"><a href="categorical-predictors.html#wald-test"><i class="fa fa-check"></i><b>6.1.2</b> Wald test</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="stratification.html"><a href="stratification.html"><i class="fa fa-check"></i><b>6.2</b> Stratification</a></li>
<li class="chapter" data-level="6.3" data-path="moderation.html"><a href="moderation.html"><i class="fa fa-check"></i><b>6.3</b> Moderation</a><ul>
<li class="chapter" data-level="6.3.1" data-path="moderation.html"><a href="moderation.html#example-1-sepal-vs-petal-length"><i class="fa fa-check"></i><b>6.3.1</b> Example 1: Sepal vs Petal Length</a></li>
<li class="chapter" data-level="6.3.2" data-path="moderation.html"><a href="moderation.html#example-2-simpsons-paradox"><i class="fa fa-check"></i><b>6.3.2</b> Example 2: Simpsonâs Paradox</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="interactions.html"><a href="interactions.html"><i class="fa fa-check"></i><b>6.4</b> Interactions</a><ul>
<li class="chapter" data-level="6.4.1" data-path="interactions.html"><a href="interactions.html#example-2"><i class="fa fa-check"></i><b>6.4.1</b> Example</a></li>
<li class="chapter" data-level="6.4.2" data-path="interactions.html"><a href="interactions.html#example-3"><i class="fa fa-check"></i><b>6.4.2</b> Example</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="confounding.html"><a href="confounding.html"><i class="fa fa-check"></i><b>6.5</b> Confounding</a></li>
<li class="chapter" data-level="6.6" data-path="variable-selection-process.html"><a href="variable-selection-process.html"><i class="fa fa-check"></i><b>6.6</b> Variable Selection Process</a><ul>
<li class="chapter" data-level="6.6.1" data-path="variable-selection-process.html"><a href="variable-selection-process.html#automated-selection-procedures"><i class="fa fa-check"></i><b>6.6.1</b> Automated selection procedures</a></li>
<li class="chapter" data-level="6.6.2" data-path="variable-selection-process.html"><a href="variable-selection-process.html#the-lesser-of-three-evils-best-subsets-pma5-section-8.7"><i class="fa fa-check"></i><b>6.6.2</b> The lesser of three evils: Best Subsets (PMA5 Section 8.7)</a></li>
</ul></li>
<li class="chapter" data-level="6.7" data-path="comparing-between-models.html"><a href="comparing-between-models.html"><i class="fa fa-check"></i><b>6.7</b> Comparing between models</a></li>
<li class="chapter" data-level="6.8" data-path="what-to-watch-out-for-1.html"><a href="what-to-watch-out-for-1.html"><i class="fa fa-check"></i><b>6.8</b> What to watch out for</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="glm.html"><a href="glm.html"><i class="fa fa-check"></i><b>7</b> Generalized Linear Models</a><ul>
<li class="chapter" data-level="7.1" data-path="fitting-glms-in-r.html"><a href="fitting-glms-in-r.html"><i class="fa fa-check"></i><b>7.1</b> Fitting GLMs in R</a></li>
<li class="chapter" data-level="7.2" data-path="binary-data.html"><a href="binary-data.html"><i class="fa fa-check"></i><b>7.2</b> Binary Data</a><ul>
<li class="chapter" data-level="7.2.1" data-path="binary-data.html"><a href="binary-data.html#example-the-effect-of-gender-on-depression"><i class="fa fa-check"></i><b>7.2.1</b> Example: The effect of gender on Depression</a></li>
<li class="chapter" data-level="7.2.2" data-path="binary-data.html"><a href="binary-data.html#multiple-logistic-regression"><i class="fa fa-check"></i><b>7.2.2</b> Multiple Logistic Regression</a></li>
<li class="chapter" data-level="7.2.3" data-path="binary-data.html"><a href="binary-data.html#interpretation"><i class="fa fa-check"></i><b>7.2.3</b> Interpretation</a></li>
<li class="chapter" data-level="7.2.4" data-path="binary-data.html"><a href="binary-data.html#goodness-of-fit"><i class="fa fa-check"></i><b>7.2.4</b> Goodness of Fit</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="classification-of-binary-outcomes.html"><a href="classification-of-binary-outcomes.html"><i class="fa fa-check"></i><b>7.3</b> Classification of Binary outcomes</a><ul>
<li class="chapter" data-level="7.3.1" data-path="classification-of-binary-outcomes.html"><a href="classification-of-binary-outcomes.html#calculating-predictions"><i class="fa fa-check"></i><b>7.3.1</b> Calculating predictions</a></li>
<li class="chapter" data-level="7.3.2" data-path="classification-of-binary-outcomes.html"><a href="classification-of-binary-outcomes.html#roc-curves"><i class="fa fa-check"></i><b>7.3.2</b> ROC Curves</a></li>
<li class="chapter" data-level="7.3.3" data-path="classification-of-binary-outcomes.html"><a href="classification-of-binary-outcomes.html#model-performance"><i class="fa fa-check"></i><b>7.3.3</b> Model Performance</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="categorical-data.html"><a href="categorical-data.html"><i class="fa fa-check"></i><b>7.4</b> Categorical Data</a></li>
<li class="chapter" data-level="7.5" data-path="count-data.html"><a href="count-data.html"><i class="fa fa-check"></i><b>7.5</b> Count Data</a></li>
</ul></li>
<li class="part"><span><b>II Multivariate Analysis</b></span></li>
<li class="chapter" data-level="8" data-path="mv-intro.html"><a href="mv-intro.html"><i class="fa fa-check"></i><b>8</b> Introduction</a></li>
<li class="chapter" data-level="9" data-path="pca.html"><a href="pca.html"><i class="fa fa-check"></i><b>9</b> Principal Component Analysis</a><ul>
<li class="chapter" data-level="9.1" data-path="basic-idea.html"><a href="basic-idea.html"><i class="fa fa-check"></i><b>9.1</b> Basic Idea</a></li>
<li class="chapter" data-level="9.2" data-path="more-generally.html"><a href="more-generally.html"><i class="fa fa-check"></i><b>9.2</b> More Generally</a></li>
<li class="chapter" data-level="9.3" data-path="generating-pcs-using-r.html"><a href="generating-pcs-using-r.html"><i class="fa fa-check"></i><b>9.3</b> Generating PCâs using R</a></li>
<li class="chapter" data-level="9.4" data-path="using-the-correlation-matrix.html"><a href="using-the-correlation-matrix.html"><i class="fa fa-check"></i><b>9.4</b> Using the correlation matrix</a></li>
<li class="chapter" data-level="9.5" data-path="data-reduction.html"><a href="data-reduction.html"><i class="fa fa-check"></i><b>9.5</b> Data Reduction</a></li>
<li class="chapter" data-level="9.6" data-path="example-analysis-of-depression.html"><a href="example-analysis-of-depression.html"><i class="fa fa-check"></i><b>9.6</b> Example Analysis of depression</a></li>
<li class="chapter" data-level="9.7" data-path="use-in-multiple-regression.html"><a href="use-in-multiple-regression.html"><i class="fa fa-check"></i><b>9.7</b> Use in Multiple Regression</a></li>
<li class="chapter" data-level="9.8" data-path="things-to-watch-out-for.html"><a href="things-to-watch-out-for.html"><i class="fa fa-check"></i><b>9.8</b> Things to watch out for</a></li>
<li class="chapter" data-level="9.9" data-path="additional-references.html"><a href="additional-references.html"><i class="fa fa-check"></i><b>9.9</b> Additional References</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="fa.html"><a href="fa.html"><i class="fa fa-check"></i><b>10</b> Factor Analysis</a><ul>
<li class="chapter" data-level="10.1" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>10.1</b> Introduction</a><ul>
<li class="chapter" data-level="10.1.1" data-path="introduction.html"><a href="introduction.html#latent-constructs"><i class="fa fa-check"></i><b>10.1.1</b> Latent Constructs</a></li>
<li class="chapter" data-level="10.1.2" data-path="introduction.html"><a href="introduction.html#efa-vs-cfa"><i class="fa fa-check"></i><b>10.1.2</b> EFA vs CFA</a></li>
</ul></li>
<li class="chapter" data-level="10.2" data-path="factor-model.html"><a href="factor-model.html"><i class="fa fa-check"></i><b>10.2</b> Factor Model</a><ul>
<li class="chapter" data-level="10.2.1" data-path="factor-model.html"><a href="factor-model.html#comparison-with-pca"><i class="fa fa-check"></i><b>10.2.1</b> Comparison with PCA</a></li>
<li class="chapter" data-level="10.2.2" data-path="factor-model.html"><a href="factor-model.html#implications"><i class="fa fa-check"></i><b>10.2.2</b> Implications</a></li>
<li class="chapter" data-level="10.2.3" data-path="factor-model.html"><a href="factor-model.html#two-big-steps"><i class="fa fa-check"></i><b>10.2.3</b> Two big steps</a></li>
</ul></li>
<li class="chapter" data-level="10.3" data-path="fa-example.html"><a href="fa-example.html"><i class="fa fa-check"></i><b>10.3</b> Example setup</a></li>
<li class="chapter" data-level="10.4" data-path="fa-extract.html"><a href="fa-extract.html"><i class="fa fa-check"></i><b>10.4</b> Factor Extraction</a><ul>
<li class="chapter" data-level="10.4.1" data-path="fa-extract.html"><a href="fa-extract.html#pc-factor-model"><i class="fa fa-check"></i><b>10.4.1</b> PC Factor Model</a></li>
<li class="chapter" data-level="10.4.2" data-path="fa-extract.html"><a href="fa-extract.html#iterated-pc-factor-model"><i class="fa fa-check"></i><b>10.4.2</b> Iterated PC Factor Model</a></li>
<li class="chapter" data-level="10.4.3" data-path="fa-extract.html"><a href="fa-extract.html#maximum-likelihood"><i class="fa fa-check"></i><b>10.4.3</b> Maximum Likelihood</a></li>
<li class="chapter" data-level="10.4.4" data-path="fa-extract.html"><a href="fa-extract.html#example-4"><i class="fa fa-check"></i><b>10.4.4</b> Example</a></li>
</ul></li>
<li class="chapter" data-level="10.5" data-path="rotating-factors.html"><a href="rotating-factors.html"><i class="fa fa-check"></i><b>10.5</b> Rotating Factors</a><ul>
<li class="chapter" data-level="10.5.1" data-path="rotating-factors.html"><a href="rotating-factors.html#varimax-rotation"><i class="fa fa-check"></i><b>10.5.1</b> Varimax Rotation</a></li>
<li class="chapter" data-level="10.5.2" data-path="rotating-factors.html"><a href="rotating-factors.html#oblique-rotation"><i class="fa fa-check"></i><b>10.5.2</b> Oblique rotation</a></li>
</ul></li>
<li class="chapter" data-level="10.6" data-path="factor-scores.html"><a href="factor-scores.html"><i class="fa fa-check"></i><b>10.6</b> Factor Scores</a></li>
<li class="chapter" data-level="10.7" data-path="what-to-watch-out-for-2.html"><a href="what-to-watch-out-for-2.html"><i class="fa fa-check"></i><b>10.7</b> What to watch out for</a></li>
<li class="chapter" data-level="10.8" data-path="help.html"><a href="help.html"><i class="fa fa-check"></i><b>10.8</b> Additional Resources</a></li>
</ul></li>
<li class="part"><span><b>III Multi-level Modeling</b></span></li>
<li class="chapter" data-level="11" data-path="introduction-1.html"><a href="introduction-1.html"><i class="fa fa-check"></i><b>11</b> Introduction</a><ul>
<li class="chapter" data-level="11.1" data-path="example-school-data.html"><a href="example-school-data.html"><i class="fa fa-check"></i><b>11.1</b> Example School Data</a></li>
<li class="chapter" data-level="11.2" data-path="multi-level-models.html"><a href="multi-level-models.html"><i class="fa fa-check"></i><b>11.2</b> Multi-level models</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="RI.html"><a href="RI.html"><i class="fa fa-check"></i><b>12</b> Random Intercept Models</a><ul>
<li class="chapter" data-level="12.1" data-path="pooling.html"><a href="pooling.html"><i class="fa fa-check"></i><b>12.1</b> Pooling</a></li>
<li class="chapter" data-level="12.2" data-path="mathematical-models.html"><a href="mathematical-models.html"><i class="fa fa-check"></i><b>12.2</b> Mathematical Models</a><ul>
<li class="chapter" data-level="12.2.1" data-path="mathematical-models.html"><a href="mathematical-models.html#complete-pooling"><i class="fa fa-check"></i><b>12.2.1</b> Complete Pooling</a></li>
<li class="chapter" data-level="12.2.2" data-path="mathematical-models.html"><a href="mathematical-models.html#no-pooling"><i class="fa fa-check"></i><b>12.2.2</b> No Pooling</a></li>
<li class="chapter" data-level="12.2.3" data-path="mathematical-models.html"><a href="mathematical-models.html#partial-pooling-ri"><i class="fa fa-check"></i><b>12.2.3</b> Partial Pooling (RI)</a></li>
</ul></li>
<li class="chapter" data-level="12.3" data-path="components-of-variance.html"><a href="components-of-variance.html"><i class="fa fa-check"></i><b>12.3</b> Components of Variance</a></li>
<li class="chapter" data-level="12.4" data-path="fitri.html"><a href="fitri.html"><i class="fa fa-check"></i><b>12.4</b> Fitting models in R</a><ul>
<li class="chapter" data-level="12.4.1" data-path="fitri.html"><a href="fitri.html#comparison-of-estimates"><i class="fa fa-check"></i><b>12.4.1</b> Comparison of estimates</a></li>
</ul></li>
<li class="chapter" data-level="12.5" data-path="estimation-methods.html"><a href="estimation-methods.html"><i class="fa fa-check"></i><b>12.5</b> Estimation Methods</a></li>
<li class="chapter" data-level="12.6" data-path="including-covariates.html"><a href="including-covariates.html"><i class="fa fa-check"></i><b>12.6</b> Including Covariates</a></li>
<li class="chapter" data-level="12.7" data-path="centering-terms.html"><a href="centering-terms.html"><i class="fa fa-check"></i><b>12.7</b> Centering terms</a><ul>
<li class="chapter" data-level="12.7.1" data-path="centering-terms.html"><a href="centering-terms.html#a-generic-dplyr-approach-to-centering."><i class="fa fa-check"></i><b>12.7.1</b> A generic <code>dplyr</code> approach to centering.</a></li>
</ul></li>
<li class="chapter" data-level="12.8" data-path="specifying-correlation-structures.html"><a href="specifying-correlation-structures.html"><i class="fa fa-check"></i><b>12.8</b> Specifying Correlation Structures</a><ul>
<li class="chapter" data-level="12.8.1" data-path="specifying-correlation-structures.html"><a href="specifying-correlation-structures.html#specifying-different-covariance-structures-in-r"><i class="fa fa-check"></i><b>12.8.1</b> Specifying different covariance structures in R</a></li>
</ul></li>
<li class="chapter" data-level="12.9" data-path="additional-references-1.html"><a href="additional-references-1.html"><i class="fa fa-check"></i><b>12.9</b> Additional References</a><ul>
<li class="chapter" data-level="12.9.1" data-path="additional-references-1.html"><a href="additional-references-1.html#package-vignettes"><i class="fa fa-check"></i><b>12.9.1</b> Package Vignettes</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="13" data-path="longitudinal.html"><a href="longitudinal.html"><i class="fa fa-check"></i><b>13</b> Longitudinal Data</a><ul>
<li class="chapter" data-level="13.1" data-path="pediatric-pain-data.html"><a href="pediatric-pain-data.html"><i class="fa fa-check"></i><b>13.1</b> Pediatric pain data</a><ul>
<li class="chapter" data-level="13.1.1" data-path="pediatric-pain-data.html"><a href="pediatric-pain-data.html#data-sample"><i class="fa fa-check"></i><b>13.1.1</b> Data sample</a></li>
<li class="chapter" data-level="13.1.2" data-path="pediatric-pain-data.html"><a href="pediatric-pain-data.html#univariate-visualizations"><i class="fa fa-check"></i><b>13.1.2</b> Univariate Visualizations</a></li>
</ul></li>
<li class="chapter" data-level="13.2" data-path="visualizing-longitudinal-data.html"><a href="visualizing-longitudinal-data.html"><i class="fa fa-check"></i><b>13.2</b> Visualizing longitudinal data</a><ul>
<li class="chapter" data-level="13.2.1" data-path="visualizing-longitudinal-data.html"><a href="visualizing-longitudinal-data.html#profile-or-spaghetti-plots"><i class="fa fa-check"></i><b>13.2.1</b> Profile or spaghetti plots</a></li>
<li class="chapter" data-level="13.2.2" data-path="visualizing-longitudinal-data.html"><a href="visualizing-longitudinal-data.html#corrmat"><i class="fa fa-check"></i><b>13.2.2</b> Correlation of pain tolerance within person across time</a></li>
</ul></li>
<li class="chapter" data-level="13.3" data-path="analyze-pain-tolerance-across-coping-style.html"><a href="analyze-pain-tolerance-across-coping-style.html"><i class="fa fa-check"></i><b>13.3</b> Analyze pain tolerance across coping style</a><ul>
<li class="chapter" data-level="13.3.1" data-path="analyze-pain-tolerance-across-coping-style.html"><a href="analyze-pain-tolerance-across-coping-style.html#two-sample-t-test"><i class="fa fa-check"></i><b>13.3.1</b> Two Sample T-test</a></li>
<li class="chapter" data-level="13.3.2" data-path="analyze-pain-tolerance-across-coping-style.html"><a href="analyze-pain-tolerance-across-coping-style.html#averaged-over-the-observed-baseline-values."><i class="fa fa-check"></i><b>13.3.2</b> Averaged over the observed baseline values.</a></li>
<li class="chapter" data-level="13.3.3" data-path="analyze-pain-tolerance-across-coping-style.html"><a href="analyze-pain-tolerance-across-coping-style.html#missing-data"><i class="fa fa-check"></i><b>13.3.3</b> Missing Data</a></li>
</ul></li>
<li class="chapter" data-level="13.4" data-path="paired-t-tests.html"><a href="paired-t-tests.html"><i class="fa fa-check"></i><b>13.4</b> Paired t-tests</a><ul>
<li class="chapter" data-level="13.4.1" data-path="paired-t-tests.html"><a href="paired-t-tests.html#but-what-about-treatment-groups"><i class="fa fa-check"></i><b>13.4.1</b> But what about treatment groups?</a></li>
</ul></li>
<li class="chapter" data-level="13.5" data-path="random-intercept-model.html"><a href="random-intercept-model.html"><i class="fa fa-check"></i><b>13.5</b> Random Intercept Model</a></li>
<li class="chapter" data-level="13.6" data-path="writing-contrasts.html"><a href="writing-contrasts.html"><i class="fa fa-check"></i><b>13.6</b> Writing Contrasts</a><ul>
<li class="chapter" data-level="13.6.1" data-path="writing-contrasts.html"><a href="writing-contrasts.html#comparing-groups-contrasts-subtracting-l_1-from-l_2"><i class="fa fa-check"></i><b>13.6.1</b> Comparing groups (contrasts) Subtracting <span class="math inline">\(L_{1}\)</span> from <span class="math inline">\(L_{2}\)</span></a></li>
<li class="chapter" data-level="13.6.2" data-path="writing-contrasts.html"><a href="writing-contrasts.html#confidence-intervals-of-those-estimates"><i class="fa fa-check"></i><b>13.6.2</b> Confidence intervals of those estimates</a></li>
</ul></li>
<li class="chapter" data-level="13.7" data-path="what-to-watch-out-for-3.html"><a href="what-to-watch-out-for-3.html"><i class="fa fa-check"></i><b>13.7</b> What to watch out for</a></li>
<li class="chapter" data-level="13.8" data-path="additional-resources.html"><a href="additional-resources.html"><i class="fa fa-check"></i><b>13.8</b> Additional Resources</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="spatial.html"><a href="spatial.html"><i class="fa fa-check"></i><b>14</b> Spatial Data</a><ul>
<li class="chapter" data-level="14.1" data-path="terminology.html"><a href="terminology.html"><i class="fa fa-check"></i><b>14.1</b> Terminology</a></li>
<li class="chapter" data-level="14.2" data-path="mapping-in-r.html"><a href="mapping-in-r.html"><i class="fa fa-check"></i><b>14.2</b> Mapping in R</a><ul>
<li class="chapter" data-level="14.2.1" data-path="mapping-in-r.html"><a href="mapping-in-r.html#plotting-region-polygons"><i class="fa fa-check"></i><b>14.2.1</b> Plotting Region polygons</a></li>
<li class="chapter" data-level="14.2.2" data-path="mapping-in-r.html"><a href="mapping-in-r.html#plotting-points"><i class="fa fa-check"></i><b>14.2.2</b> Plotting points</a></li>
</ul></li>
<li class="chapter" data-level="14.3" data-path="spatial-influence.html"><a href="spatial-influence.html"><i class="fa fa-check"></i><b>14.3</b> Spatial Influence</a><ul>
<li class="chapter" data-level="14.3.1" data-path="spatial-influence.html"><a href="spatial-influence.html#distance-between-points"><i class="fa fa-check"></i><b>14.3.1</b> Distance between points</a></li>
<li class="chapter" data-level="14.3.2" data-path="spatial-influence.html"><a href="spatial-influence.html#spatial-weights-matrix"><i class="fa fa-check"></i><b>14.3.2</b> Spatial Weights Matrix</a></li>
<li class="chapter" data-level="14.3.3" data-path="spatial-influence.html"><a href="spatial-influence.html#identifying-neighbors"><i class="fa fa-check"></i><b>14.3.3</b> Identifying Neighbors</a></li>
<li class="chapter" data-level="14.3.4" data-path="spatial-influence.html"><a href="spatial-influence.html#neighborhood-matrix"><i class="fa fa-check"></i><b>14.3.4</b> Neighborhood matrix</a></li>
</ul></li>
<li class="chapter" data-level="14.4" data-path="modeling-geographically-correlated-data.html"><a href="modeling-geographically-correlated-data.html"><i class="fa fa-check"></i><b>14.4</b> Modeling geographically correlated data</a><ul>
<li class="chapter" data-level="14.4.1" data-path="modeling-geographically-correlated-data.html"><a href="modeling-geographically-correlated-data.html#geographically-weighted-regression"><i class="fa fa-check"></i><b>14.4.1</b> Geographically weighted regression</a></li>
<li class="chapter" data-level="14.4.2" data-path="modeling-geographically-correlated-data.html"><a href="modeling-geographically-correlated-data.html#bayesian-models"><i class="fa fa-check"></i><b>14.4.2</b> Bayesian Models</a></li>
<li class="chapter" data-level="14.4.3" data-path="modeling-geographically-correlated-data.html"><a href="modeling-geographically-correlated-data.html#random-intercept-model-1"><i class="fa fa-check"></i><b>14.4.3</b> Random Intercept Model</a></li>
</ul></li>
<li class="chapter" data-level="14.5" data-path="additional-info.html"><a href="additional-info.html"><i class="fa fa-check"></i><b>14.5</b> Additional Info</a></li>
</ul></li>
<li class="part"><span><b>IV Other Topics</b></span></li>
<li class="chapter" data-level="15" data-path="mda.html"><a href="mda.html"><i class="fa fa-check"></i><b>15</b> Missing Data</a><ul>
<li class="chapter" data-level="15.1" data-path="identifying-missing-data.html"><a href="identifying-missing-data.html"><i class="fa fa-check"></i><b>15.1</b> Identifying missing data</a><ul>
<li class="chapter" data-level="15.1.1" data-path="identifying-missing-data.html"><a href="identifying-missing-data.html#visualize-missing-patterns"><i class="fa fa-check"></i><b>15.1.1</b> Visualize missing patterns</a></li>
</ul></li>
<li class="chapter" data-level="15.2" data-path="effects-of-nonresponse.html"><a href="effects-of-nonresponse.html"><i class="fa fa-check"></i><b>15.2</b> Effects of Nonresponse</a></li>
<li class="chapter" data-level="15.3" data-path="missing-data-mechanisms.html"><a href="missing-data-mechanisms.html"><i class="fa fa-check"></i><b>15.3</b> Missing Data Mechanisms</a><ul>
<li class="chapter" data-level="15.3.1" data-path="missing-data-mechanisms.html"><a href="missing-data-mechanisms.html#demonstration-via-simulation"><i class="fa fa-check"></i><b>15.3.1</b> Demonstration via Simulation</a></li>
</ul></li>
<li class="chapter" data-level="15.4" data-path="general-strategies.html"><a href="general-strategies.html"><i class="fa fa-check"></i><b>15.4</b> General strategies</a><ul>
<li class="chapter" data-level="15.4.1" data-path="general-strategies.html"><a href="general-strategies.html#complete-cases-analysis"><i class="fa fa-check"></i><b>15.4.1</b> Complete cases analysis</a></li>
<li class="chapter" data-level="15.4.2" data-path="general-strategies.html"><a href="general-strategies.html#available-case-analysis"><i class="fa fa-check"></i><b>15.4.2</b> Available-case analysis</a></li>
<li class="chapter" data-level="15.4.3" data-path="general-strategies.html"><a href="general-strategies.html#imputation"><i class="fa fa-check"></i><b>15.4.3</b> Imputation</a></li>
</ul></li>
<li class="chapter" data-level="15.5" data-path="imputation-methods.html"><a href="imputation-methods.html"><i class="fa fa-check"></i><b>15.5</b> Imputation Methods</a></li>
<li class="chapter" data-level="15.6" data-path="multiple-imputation-mi.html"><a href="multiple-imputation-mi.html"><i class="fa fa-check"></i><b>15.6</b> Multiple Imputation (MI)</a><ul>
<li class="chapter" data-level="15.6.1" data-path="multiple-imputation-mi.html"><a href="multiple-imputation-mi.html#goals"><i class="fa fa-check"></i><b>15.6.1</b> Goals</a></li>
<li class="chapter" data-level="15.6.2" data-path="multiple-imputation-mi.html"><a href="multiple-imputation-mi.html#technique"><i class="fa fa-check"></i><b>15.6.2</b> Technique</a></li>
<li class="chapter" data-level="15.6.3" data-path="multiple-imputation-mi.html"><a href="multiple-imputation-mi.html#mi-as-a-paradigm"><i class="fa fa-check"></i><b>15.6.3</b> MI as a paradigm</a></li>
<li class="chapter" data-level="15.6.4" data-path="multiple-imputation-mi.html"><a href="multiple-imputation-mi.html#inference-on-mi"><i class="fa fa-check"></i><b>15.6.4</b> Inference on MI</a></li>
</ul></li>
<li class="chapter" data-level="15.7" data-path="multiple-imputation-using-chained-equations-mice.html"><a href="multiple-imputation-using-chained-equations-mice.html"><i class="fa fa-check"></i><b>15.7</b> Multiple Imputation using Chained Equations (MICE)</a><ul>
<li class="chapter" data-level="15.7.1" data-path="multiple-imputation-using-chained-equations-mice.html"><a href="multiple-imputation-using-chained-equations-mice.html#overview"><i class="fa fa-check"></i><b>15.7.1</b> Overview</a></li>
<li class="chapter" data-level="15.7.2" data-path="multiple-imputation-using-chained-equations-mice.html"><a href="multiple-imputation-using-chained-equations-mice.html#process-algorithm"><i class="fa fa-check"></i><b>15.7.2</b> Process / Algorithm</a></li>
<li class="chapter" data-level="15.7.3" data-path="multiple-imputation-using-chained-equations-mice.html"><a href="multiple-imputation-using-chained-equations-mice.html#convergence"><i class="fa fa-check"></i><b>15.7.3</b> Convergence</a></li>
<li class="chapter" data-level="15.7.4" data-path="multiple-imputation-using-chained-equations-mice.html"><a href="multiple-imputation-using-chained-equations-mice.html#imputation-methods-1"><i class="fa fa-check"></i><b>15.7.4</b> Imputation Methods</a></li>
</ul></li>
<li class="chapter" data-level="15.8" data-path="example-prescribed-amount-of-missing-.html"><a href="example-prescribed-amount-of-missing-.html"><i class="fa fa-check"></i><b>15.8</b> Example: Prescribed amount of missing.</a><ul>
<li class="chapter" data-level="15.8.1" data-path="example-prescribed-amount-of-missing-.html"><a href="example-prescribed-amount-of-missing-.html#multiply-impute-the-missing-data-using-mice"><i class="fa fa-check"></i><b>15.8.1</b> Multiply impute the missing data using <code>mice()</code></a></li>
<li class="chapter" data-level="15.8.2" data-path="example-prescribed-amount-of-missing-.html"><a href="example-prescribed-amount-of-missing-.html#check-the-imputation-method-used-on-each-variable."><i class="fa fa-check"></i><b>15.8.2</b> Check the imputation method used on each variable.</a></li>
<li class="chapter" data-level="15.8.3" data-path="example-prescribed-amount-of-missing-.html"><a href="example-prescribed-amount-of-missing-.html#check-convergence"><i class="fa fa-check"></i><b>15.8.3</b> Check Convergence</a></li>
<li class="chapter" data-level="15.8.4" data-path="example-prescribed-amount-of-missing-.html"><a href="example-prescribed-amount-of-missing-.html#look-at-the-values-generated-for-imputation"><i class="fa fa-check"></i><b>15.8.4</b> Look at the values generated for imputation</a></li>
<li class="chapter" data-level="15.8.5" data-path="example-prescribed-amount-of-missing-.html"><a href="example-prescribed-amount-of-missing-.html#create-a-complete-data-set-by-filling-in-the-missing-data-using-the-imputations"><i class="fa fa-check"></i><b>15.8.5</b> Create a complete data set by filling in the missing data using the imputations</a></li>
<li class="chapter" data-level="15.8.6" data-path="example-prescribed-amount-of-missing-.html"><a href="example-prescribed-amount-of-missing-.html#visualize-imputations"><i class="fa fa-check"></i><b>15.8.6</b> Visualize Imputations</a></li>
<li class="chapter" data-level="15.8.7" data-path="example-prescribed-amount-of-missing-.html"><a href="example-prescribed-amount-of-missing-.html#calculating-bias"><i class="fa fa-check"></i><b>15.8.7</b> Calculating bias</a></li>
</ul></li>
<li class="chapter" data-level="15.9" data-path="final-thoughts.html"><a href="final-thoughts.html"><i class="fa fa-check"></i><b>15.9</b> Final thoughts</a></li>
<li class="chapter" data-level="15.10" data-path="additional-references-2.html"><a href="additional-references-2.html"><i class="fa fa-check"></i><b>15.10</b> Additional References</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/norcalbiostat/AppliedStatistics_notes" target="blank">View source on Github</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Applied Statistics</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="spatial-influence" class="section level2">
<h2><span class="header-section-number">14.3</span> Spatial Influence</h2>
<ul>
<li>The closer the points, the more influence they should have on each other.</li>
<li>Want to identify âneighborsâ</li>
<li>Neighbors can be identified based on
<ul>
<li>(inverse) distance between centroids or points</li>
<li>existence of a shared border</li>
<li>length of shared borders</li>
</ul></li>
</ul>
<div id="distance-between-points" class="section level3">
<h3><span class="header-section-number">14.3.1</span> Distance between points</h3>
<p>Calculate the great circle distance between points.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">county.cent.mat &lt;-<span class="st"> </span><span class="kw">as.matrix</span>(norcal[,<span class="kw">c</span>(<span class="st">&#39;long.c&#39;</span>, <span class="st">&#39;lat.c&#39;</span>)]) <span class="co"># convert lat/long centroids to a matrix</span>
D &lt;-<span class="st"> </span>raster<span class="op">::</span><span class="kw">pointDistance</span>(county.cent.mat, <span class="dt">lonlat=</span><span class="ot">TRUE</span>) 
<span class="kw">rownames</span>(D) &lt;-<span class="st"> </span><span class="kw">colnames</span>(D) &lt;-<span class="st"> </span>norcal<span class="op">$</span>subregion
D[<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">5</span>]
##               butte    colusa del norte    glenn humboldt
## butte          0.00        NA        NA       NA       NA
## colusa     77055.36      0.00        NA       NA       NA
## del norte 303103.83 319031.41       0.0       NA       NA
## glenn      68210.62  48641.26  271321.8      0.0       NA
## humboldt  225521.47 219448.27  116948.0 175980.8        0</code></pre></div>
<p><img src="images/q.png" /> What are the units of the values in <code>D</code>?</p>
<p><img src="images/q.png" /> Why couldnât we have just used <code>dist(norcal)</code> here to create a distance matrix?</p>
</div>
<div id="spatial-weights-matrix" class="section level3">
<h3><span class="header-section-number">14.3.2</span> Spatial Weights Matrix</h3>
<p>The further away the points, the lower the correlation. The simplest approach is to use the inverse distance, and then normalize weights across the rows.</p>
<ol style="list-style-type: decimal">
<li>Calculate 1/ each distance (cell).</li>
<li>Some values are <code>Inf</code>. Why did this happen? Set these to <code>NA</code></li>
<li>Calculate the row totals</li>
<li>Divide the weight matrix <code>W</code> by the row totals to normalize rows</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">W &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">/</span>D 
W[<span class="op">!</span><span class="kw">is.finite</span>(W)] &lt;-<span class="st"> </span><span class="ot">NA</span> 
rtot &lt;-<span class="st"> </span><span class="kw">rowSums</span>(W, <span class="dt">na.rm=</span><span class="ot">TRUE</span>) 
W &lt;-<span class="st"> </span>W<span class="op">/</span>rtot 
W[<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">5</span>] <span class="co"># confirm the weights add up to 1 across the rows</span>
##               butte    colusa  del norte     glenn humboldt
## butte            NA        NA         NA        NA       NA
## colusa    1.0000000        NA         NA        NA       NA
## del norte 0.5128007 0.4871993         NA        NA       NA
## glenn     0.3768293 0.5284354 0.09473533        NA       NA
## humboldt  0.1909279 0.1962118 0.36818384 0.2446764       NA</code></pre></div>
</div>
<div id="identifying-neighbors" class="section level3">
<h3><span class="header-section-number">14.3.3</span> Identifying Neighbors</h3>
<p>Recap terminology. polygons, shapes, data frames, coordinates. This section converts a lot of R objects from one object type to another.</p>
<ol style="list-style-type: decimal">
<li><strong>Points are within a certain distance away from each other</strong></li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(spdep)
norcal_nb &lt;-<span class="st"> </span><span class="kw">dnearneigh</span>(<span class="dt">x=</span>county.cent.mat, <span class="dt">d1=</span><span class="dv">0</span>, <span class="dt">d2=</span><span class="dv">80</span>, <span class="dt">longlat=</span>T)
<span class="kw">summary</span>(norcal_nb)
## Neighbour list object:
## Number of regions: 16 
## Number of nonzero links: 26 
## Percentage nonzero weights: 10.15625 
## Average number of links: 1.625 
## 4 regions with no links:
## 3 7 9 13
## Link number distribution:
## 
## 0 1 2 3 4 
## 4 6 1 2 3 
## 6 least connected regions:
## 5 8 10 11 12 16 with 1 link
## 3 most connected regions:
## 1 2 4 with 4 links</code></pre></div>
<p>The <code>dnearneigh</code> function identifies neighbors of region points by Great Circle distance (specified using <code>longlat=TRUE</code>) between lower (<code>d1</code>) and upper (<code>80</code>) bounds in kilometers. This creates a <code>neighborhood</code> object. Weâll look at the structure of this shortly.</p>
<p>To visualize these neighbors, we need to combine this neighborhood information back onto the data frame with existing coordinate data. To do that we need to convert the neighborhood object to data frame using <code>nb_to_df</code>, a <a href="http://mbjoseph.github.io/2015/06/15/nb_ggmap.html">user defined function</a> that was googled.</p>
<p>Then we can map county centers and connect neighbors with lines.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">norcal.nb.toplot &lt;-<span class="st"> </span><span class="kw">nb_to_df</span>(norcal_nb, county.cent.mat)

<span class="kw">ggmap</span>(norcal.map) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">data=</span>norcal, <span class="kw">aes</span>(<span class="dt">x=</span>long.c, <span class="dt">y=</span>lat.c), <span class="dt">col=</span><span class="st">&quot;red&quot;</span>, <span class="dt">size=</span><span class="dv">2</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_segment</span>(<span class="dt">data=</span>norcal.nb.toplot, <span class="kw">aes</span>(<span class="dt">x=</span>x, <span class="dt">xend=</span>xend, <span class="dt">y=</span>y, <span class="dt">yend=</span>yend), <span class="dt">lwd=</span><span class="fl">1.5</span>)</code></pre></div>
<p><img src="spatial_files/figure-html/unnamed-chunk-18-1.png" width="672" /></p>
<ol start="2" style="list-style-type: decimal">
<li><strong>Adjacent polygons</strong></li>
</ol>
<p>The <code>maps</code> data provides polygon data in that it gives us a series of lat/long points and an order on how to connect them. This is not quite the same as a <em>shape file</em>. Using a function <a href="https://gis.stackexchange.com/questions/18311/instantiating-spatial-polygon-without-using-a-shapefile-in-r">found on this StackExchange post</a> we convert the data frame containing polygon information to a special <code>SpatialPolygon</code> object.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(sp)

local &lt;-<span class="st"> </span>counties <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">        </span><span class="kw">filter</span>(region<span class="op">==</span><span class="st">&quot;california&quot;</span>, subregion <span class="op">%in%</span><span class="st"> </span>
<span class="st">                 </span><span class="kw">c</span>(<span class="st">&#39;butte&#39;</span>, <span class="st">&#39;glenn&#39;</span>, <span class="st">&#39;colusa&#39;</span>, <span class="st">&#39;plumas&#39;</span>, <span class="st">&#39;sutter&#39;</span>, <span class="st">&#39;yuba&#39;</span>, <span class="st">&#39;tehama&#39;</span>)) <span class="op">%&gt;%</span>
<span class="st">        </span><span class="kw">select</span>(long, lat, subregion)

local.spp &lt;-<span class="st"> </span>local <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(subregion) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">do</span>(<span class="dt">poly=</span><span class="kw">select</span>(., long, lat) <span class="op">%&gt;%</span><span class="kw">Polygon</span>()) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">rowwise</span>() <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">do</span>(<span class="dt">polys=</span><span class="kw">Polygons</span>(<span class="kw">list</span>(.<span class="op">$</span>poly),.<span class="op">$</span>subregion)) <span class="op">%&gt;%</span>
<span class="st">  </span>{<span class="kw">SpatialPolygons</span>(.<span class="op">$</span>polys)}

<span class="kw">plot</span>(local.spp)</code></pre></div>
<p><img src="spatial_files/figure-html/unnamed-chunk-19-1.png" width="672" /></p>
<p>Now we can create the neighborhood matrix on this polygon shape file using <code>poly2nb</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">local_nb &lt;-<span class="st"> </span><span class="kw">poly2nb</span>(local.spp)
<span class="kw">summary</span>(local_nb)
## Neighbour list object:
## Number of regions: 7 
## Number of nonzero links: 24 
## Percentage nonzero weights: 48.97959 
## Average number of links: 3.428571 
## Link number distribution:
## 
## 3 6 
## 6 1 
## 6 least connected regions:
## colusa glenn plumas sutter tehama yuba with 3 links
## 1 most connected region:
## butte with 6 links</code></pre></div>

<div class="rmdnote">
The <code>maptools</code> package also has a <code>map2SpatialPoylgons</code> function that may be helpful in some situations to convert maps to polygons. In this example we used the function <code>get_map()</code> which returned a <code>data.frame</code>. The <code>map()</code> function is another way to get map data out of the <code>maps</code> library, but it returns a <code>map</code> object.
</div>

</div>
<div id="neighborhood-matrix" class="section level3">
<h3><span class="header-section-number">14.3.4</span> Neighborhood matrix</h3>
<p>A neighborhood matrix is not stored in R the way we like to imagine matrices (squares). Instead it is a list, where each entry in the list is a vector of neighbor identifiers.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">str</span>(norcal_nb)
## List of 16
##  $ : int [1:4] 2 4 14 15
##  $ : int [1:4] 1 4 6 14
##  $ : int 0
##  $ : int [1:4] 1 2 6 15
##  $ : int 16
##  $ : int [1:3] 2 4 8
##  $ : int 0
##  $ : int 6
##  $ : int 0
##  $ : int 12
##  $ : int 15
##  $ : int 10
##  $ : int 0
##  $ : int [1:2] 1 2
##  $ : int [1:3] 1 4 11
##  $ : int 5
##  - attr(*, &quot;class&quot;)= chr &quot;nb&quot;
##  - attr(*, &quot;nbtype&quot;)= chr &quot;distance&quot;
##  - attr(*, &quot;distances&quot;)= num [1:2] 0 80
##  - attr(*, &quot;region.id&quot;)= chr [1:16] &quot;1&quot; &quot;2&quot; &quot;3&quot; &quot;4&quot; ...
##  - attr(*, &quot;call&quot;)= language dnearneigh(x = county.cent.mat, d1 = 0, d2 = 80, longlat = T)
##  - attr(*, &quot;dnn&quot;)= num [1:2] 0 80
##  - attr(*, &quot;bounds&quot;)= chr [1:2] &quot;GT&quot; &quot;LE&quot;
##  - attr(*, &quot;sym&quot;)= logi TRUE</code></pre></div>
<p>Recall the first few counties in norcal are Butte, Colusa and Del Norte. The first three lines in <code>norcal_nb</code> identify the neighbors for that county.</p>
<ul>
<li>Butte has 3 neighbors that are within 80km (50 miles) away. There are 3 lines extending out of Butte.</li>
<li>Colusa also has 3.</li>
<li>Del Norte has 0 neighbors.</li>
</ul>
<p>Another example is the neighborhood matrix created using the local county shape files.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">str</span>(local_nb)
## List of 7
##  $ : int [1:6] 2 3 4 5 6 7
##  $ : int [1:3] 1 3 5
##  $ : int [1:3] 1 2 6
##  $ : int [1:3] 1 6 7
##  $ : int [1:3] 1 2 7
##  $ : int [1:3] 1 3 4
##  $ : int [1:3] 1 4 5
##  - attr(*, &quot;class&quot;)= chr &quot;nb&quot;
##  - attr(*, &quot;region.id&quot;)= chr [1:7] &quot;butte&quot; &quot;colusa&quot; &quot;glenn&quot; &quot;plumas&quot; ...
##  - attr(*, &quot;call&quot;)= language poly2nb(pl = local.spp)
##  - attr(*, &quot;type&quot;)= chr &quot;queen&quot;
##  - attr(*, &quot;sym&quot;)= logi TRUE</code></pre></div>
<p>We can transform a neighborhood object to a matrix using <code>nb2mat</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">local_nb_mat &lt;-<span class="st"> </span><span class="kw">nb2mat</span>(local_nb, <span class="dt">style=</span><span class="st">&#39;B&#39;</span>, <span class="dt">zero.policy =</span> <span class="ot">TRUE</span>)
<span class="kw">colnames</span>(local_nb_mat) &lt;-<span class="st"> </span><span class="kw">unique</span>(local<span class="op">$</span>subregion)
<span class="kw">kable</span>(local_nb_mat)</code></pre></div>
<table>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
butte
</th>
<th style="text-align:right;">
colusa
</th>
<th style="text-align:right;">
glenn
</th>
<th style="text-align:right;">
plumas
</th>
<th style="text-align:right;">
sutter
</th>
<th style="text-align:right;">
tehama
</th>
<th style="text-align:right;">
yuba
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
butte
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
colusa
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
glenn
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
plumas
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
sutter
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
tehama
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
yuba
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
</tr>
</tbody>
</table>
<p>We can use this matrix structure as a correlation structure in a random intercept model. <em>Details forthcoming</em></p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="mapping-in-r.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="modeling-geographically-correlated-data.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "";
    if (src === "" || src === "true") src = "https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
